<!-- prettier-ignore-start -->
<!-- SOMETHING AUTO-GENERATED BY TOOLS - START -->
<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->
<!-- code_chunk_output -->

- [介绍](#介绍)
  - [痛点](#痛点 "痛点")
  - [vue-ts-template是什么](#vue-ts-template是什么 "vue-ts-template是什么")
  - [主要的库](#主要的库 "主要的库")
  - [快速开始](#快速开始 "快速开始")
    - [初始化应用](#初始化应用 "初始化应用")
    - [创建](#创建 "创建")
- [环境相关](#环境相关 "环境相关")
  - [Node](#node)
    - [npm](#npm)
  - [Git](#git)
    - [commit格式](#commit格式 "commit格式")
  - [Editor-编辑器](#editor-编辑器 "editor-编辑器")
    - [VsCode](#vscode)
    - [Other](#other)
- [环境变量使用规范](#环境变量使用规范 "环境变量使用规范")
  - [配置文件](#配置文件 "配置文件")
  - [运行时可用的环境变量](#运行时可用的环境变量 "运行时可用的环境变量")
  - [在 public/\*\*/\* 中通过 EJS 语法直接取用](#在-public-中通过-ejs-语法直接取用)
  - [在 src/\*\*/\* 中通过 process.env 取用](#在-src-中通过-processenv-取用)
  - [在 src/\*\*/\* 中进行条件编译](#在-src-中进行条件编译)
- [组件](#组件 "组件")
  - [埋点](#埋点)
  - [svg-icon](#svg-icon)
- [Mock](#mock)
  - [javascript模式](#javascript模式)
  - [json模式](#json模式)
  - [引用](#引用)
- [模板](#模板 "模板")
  - [配置说明](#配置说明)
    - [项目基础信息](#项目基础信息)
    - [html模板](#html模板)
    - [路由](#路由)
    - [打包](#打包)
  - [vue-template-admin 通用后台管理模板](#vue-template-admin-通用后台管理模板)
    - [路由访问流程](#路由访问流程)
    - [页面路由配置](#页面路由配置)
    - [登录](#登录)
    - [菜单配置](#菜单配置)
    - [整体布局配置](#整体布局配置)
    - [全局状态 store](#全局状态-store)
      - [modules/user](#modulesuser)
  - [vue-template-homesite 通用的企业官网模板](#vue-template-homesite-通用的企业官网模板)
  - [vue-template-mobile 通用的移动端模板](#vue-template-mobile-通用的移动端模板)
- [目录结构](#目录结构 "目录结构")
  - [工程目录结构](#工程目录结构)
  - [子应用目录结构](#子应用目录结构)
- [前端部署](#前端部署 "前端部署")
  - [后端支持跨域](#后端支持跨域)
    - [无虚拟前缀](#无虚拟前缀)
    - [开启虚拟前缀](#开启虚拟前缀)
  
<!-- /code_chunk_output -->
<!-- SOMETHING AUTO-GENERATED BY TOOLS - END -->
<!-- prettier-ignore-end -->

# 介绍

[项目地址-http://gitlab.icinfo.co/fed/vue-ts-template](http://gitlab.icinfo.co/fed/vue-ts-template) 

## 痛点

在开发一个前端项目之前，我们可能需要做如下准备工作：
- 搭建开发环境
- 约定代码规范
- 封装API请求
- 配置路由
- 实现布局、菜单、导航
- 实现登录
- 权限管理
- ...

除了准备工作之外，还会遇到很多相似的业务类型，比如中后台应用大多都是工作台、增删改查、权限、图表等。如果每次项目都完全手动处理一遍，不仅耗费时间，久而久之可能会存在多种技术栈、开发规范，导致开发流程不统一，历史项目越来越难维护。所以我们需要一套完整的解决方案，管理开发到部署整个流程。

## vue-ts-template是什么

`vue-ts-template` 是一个基于vue-cli4的多项目模板脚手架。支持配置式路由和约定式路由，并以此进行功能扩展。配以二次封装的业务组件，支持各种功能扩展和业务需求。     

它主要具备以下特点：
- 🚀  __快速__ ，内置了路由、开发、构建等，并且提供测试、布局、权限、国际化、状态管理、API请求、数据字典、SvgIcon等插件，可以满足大部分日常开发需求。  
  
- 🧨  __简单__ ，贯彻“约定优于配置”思想，设计插件上尽可能用约定替代配置，同时提供统一的模板入口，简单简洁又不失灵活。提供一致性的API入口，一致化的体验，上手更轻松。

- 💪  __健壮__ ，只需要关心页面内容，减少写BUG的机会！提供单元测试、覆盖测试能力保障项目质量。

- 📦  __可扩展__ ，目前有`vue-template-admin(PC管理端)`、`vue-template-homesite(PC企业端)`、`vue-template-bigscreen(大屏)`、`vue-template-mobile(h5移动端)`等多种模板

- 📡  __面向未来__ ，为现代浏览器轻松产出原生的 ES2015 代码，或将你的 Vue 组件构建为原生的 Web Components 组件

## 主要的库

|   名称   | 版本  |  备注  |
| --- |--- |--- |
| vue | 2.6.12 |  |
| vue-router | 3.4.9  |  |
| vuex | 3.4.9  |  |
| typescript | 4.1.5   |  |
| axios | 0.19.2    |  |
| element-ui | 2.13.2    | [文档](https://element.eleme.io/#/zh-CN/component/installation) |
| typedoc | 0.20.34   |  |
| prettier | 1.19.1    |  |
| jest | 24.9.0    | 测试库 |
| [icinfo-util](https://www.npmjs.com/package/icinfo-util) | -    | 工具类 [文档](https://majinhui04.github.io/icinfo-util/index.html) |
| sharegood-ui | -   | 基于element-ui封装的PC组件库 [文档](http://sharegood-element-ui.fat1.icinfo.co/#/zh-CN/component/README) |


## 快速开始
### 初始化应用
:::tip
请先配置[SSH Keys](http://gitlab.icinfo.co/profile/keys)。
:::

**初始化工作空间**

```
## 创建项目空间
git clone git@gitlab.icinfo.co:credit-fe/demo.git
## 进入项目
cd demo
## 关联模板地址
git remote add vue-ts-template git@gitlab.icinfo.co:fed/vue-ts-template.git
## 将模板项目master分支拉到本地dev分支
git pull vue-ts-template master:dev
## 进入分支
git checkout dev
```



### 创建

`选择文件类型`

![](https://tva1.sinaimg.cn/large/008i3skNly1gq9uj6bwptj30to0c2jvt.jpg)

`选择模板类别`

![](https://tva1.sinaimg.cn/large/008i3skNgy1gq9ukm0delj30t80csjww.jpg)

`根据之前创建的项目名称启动`

```
npm run dev:demo
```

`默认会启动服务打开浏览器`

![](https://tva1.sinaimg.cn/large/008i3skNgy1gq9uo4oaxwj31cn0u0drp.jpg)




`新建页面`

![](https://tva1.sinaimg.cn/large/008i3skNly1gq9wwoo7nbj30rk0bkgpy.jpg)
![](https://tva1.sinaimg.cn/large/008i3skNly1gq9wwzmt86j30qk08wjvb.jpg)
![](https://tva1.sinaimg.cn/large/008i3skNly1gq9wx4bi45j314i0907bl.jpg)


# 环境相关

## Node

首先得有 [Node.js](https://nodejs.org/)，并确保 node 版本是 10.13 或以上。

```bash

# 打印 node 版本 
node -v
```

### npm
> 请使用`npm install`安装依赖。(不要用淘宝镜像)，不要用yarn、cnpm。

```bash
# 如果有设置淘宝镜像源，则先还原回默认镜像
npm config set registry http://registry.npmjs.org
```
不然有可能出现如下错误

![](https://tva1.sinaimg.cn/large/008i3skNly1gs0k0b5drqj30k00eu41b.jpg)

## Git

克隆项目前设置换行符

```bash
# 系统设置提交时转换为LF，检出时不转换
git config --global core.autocrlf input

```


### commit格式
**.vcmrc**
格式 `type: subject` ，比如 `feat: 新增登录模块`

> 注意冒号后面有空格！注意冒号后面有空格！注意冒号后面有空格！

```javascript

[
    'docs', // Adds or alters documentation. 仅仅修改了文档，比如README, CHANGELOG, CONTRIBUTE等等
    'chore', // Other changes that don't modify src or test files. 改变构建流程、或者增加依赖库、工具等
    'feat', // Adds a new feature. 新增feature
    'fix', // Solves a bug. 修复bug
    'merge', // Merge branch ? of ?.
    'perf', // Improves performance. 优化相关，比如提升性能、体验
    'refactor', // Rewrites code without feature, performance or bug changes. 代码重构，没有加新功能或者修复bug
    'revert', // Reverts a previous commit. 回滚到上一个版本
    'style', // Improves formatting, white-space. 仅仅修改了空格、格式缩进、都好等等，不改变代码逻辑
    'test', // Adds or modifies tests. 测试用例，包括单元测试、集成测试等
]
```

## Editor-编辑器


### VsCode
**.vscode/settings.json**
已配置保存自动格式化 

+ 必要插件
    - `ESLint`
    - `Vetur`
    - `Prettier - Code formatter`
    

### Other

- `tab`转空格，一个`tab`=4个空格
- 换行符`lf`


# 环境变量使用规范

## 配置文件


- 配置文件

  - 本地环境：.env.development & .env.development.local
  - 开发环境：.env.fat 
  - 测试环境：.env.uat or .env.test
  - 生产环境：.env.production

- 变量同名时，会覆盖前面定义的
    - .env.development.local 中的变量优先级最高
    - .env.development.local 不会被 git 追踪，通常用于重写频繁变动的变量，如：

    ```
    VUE_APP_MOCK = true
    VUE_APP_MOCK = false

    DEV_PROXY_TARGET_API = 后端开发A的接口服务
    DEV_PROXY_TARGET_API = 后端开发B的接口服务
    DEV_PROXY_TARGET_API = 后端开发C的接口服务

    ```

## 运行时可用的环境变量


```ts
/**
 * 运行时可用的：process.env.NODE_ENV、process.env.BASE_URL、process.env.VUE_APP_*
 * 环境判断推荐使用 process.env.VUE_APP_ENV
 */
interface Env {
  // development:开发环境 | production:非开发环境 | test:自动化测试
  readonly NODE_ENV: 'development' | 'production' | 'test'

  // dev:开发环境 | uat:测试环境 | prod:生产环境
  readonly VUE_APP_ENV: 'dev' | 'uat' | 'prod'

  // 页面部署路径，详情：https://cli.vuejs.org/zh/config/#publicpath
  readonly BASE_URL: '' | './' | '/**/' // 需要尾斜杠，如没有则构建时会自动加上

  // 接口前缀
  readonly VUE_APP_BASEURL_API: '/**/*' | 'http*(s)://**/*' // 不需要尾斜杠

  // 是否启用 mockjs
  readonly VUE_APP_MOCK: 'true' | 'false'

  // ...
}
```

## 在 public/\*\*/\* 中通过 EJS 语法直接取用

- html/htm

  ```html
  <!-- 引用 public 中的资源时一定要加上 BASE_URL -->
  <% if(VUE_APP_ENV === 'dev' || VUE_APP_ENV === 'stage') { %>
  <script src="<%= BASE_URL %>libs/xxx.js"></script>
  <% } else { %>
  <script src="<%= BASE_URL %>libs/xxx.min.js"></script>
  <% } %>
  ```

- js

  ```js
  var appEnv = '<%= VUE_APP_ENV %>'

  // 对于不明确的变量，使用安全的取用方式，除了入口 html（入口 html 不存在 obj 变量）
  var xxx = '<%= obj.VUE_APP_XXX || "xxx" %>'
  ```

- json
  ```json
  {
    "xxx": "<%= obj.VUE_APP_XXX || 'xxx' %>"
  }
  ```

## 在 src/\*\*/\* 中通过 process.env 取用

> 注意：命名必须以VUE_APP_开头

- vue

  ```html
  <script>
    export default {
      data() {
        return {
          xxx: process.env.VUE_APP_XXX,
          xxx2: this.$env.VUE_APP_XXX2, // 通过 vm.$env 间接取用（推荐）
        }
      },
    }
  </script>

  <template>
    <!-- 在模板中只能间接取用 -->
    <a
      download
      target="_blank"
      :href="$env.BASE_URL + 'docs/系统操作指南v1.pdf'"
    >
      系统操作指南
    </a>
  </template>
  ```

- js
  ```js
  const xxx = process.env.VUE_APP_XXX
  ```

## 在 src/\*\*/\* 中进行条件编译

必须是运行时可用的环境变量，并且变量值不能为 undefined，否则模块必定会打包

```js
// 正确的用法1
if (process.env.VUE_APP_ENV === 'dev') {
  require('xxx')
}
// 正确的用法2
if (process.env.VUE_APP_ENV === 'dev' || process.env.VUE_APP_ENV === 'stage') {
  require('xxx')
}

// 错误的用法1
const env = process.env
if (env.VUE_APP_ENV === 'dev' || env.VUE_APP_ENV === 'stage') {
  require('xxx')
}
// 错误的用法2
if (this.$env.VUE_APP_ENV === 'dev' || this.$env.VUE_APP_ENV === 'stage') {
  require('xxx')
}
```


# 组件

## 埋点

```javascript
// 坑位埋点指令 <el-button v-stat="{ name: '获取nodes' }">获取nodes</el-button>
Vue.directive('stat', {
    bind(el, binding) {
        el.addEventListener(
            'click',
            () => {
                const data = binding.value
                // todo 发起请求
                // http.request({     
                //     url: '/mock/stat',
                //     params: {
                //         ...data,
                //     },
                // })
            },
            false,
        )
    },
})
```

## svg-icon

- 单色模式(非'mt-'前缀)，大小继承至 font-size，颜色继承至 color
- 多色模式('mt-'前缀)，大小继承至 font-size，颜色则原始显示 

将单色`xxx.svg`，多色`mt-xxx.svg`文件放入`src/components/SvgIcon/icons/`

通过引入 **@/injects** 声明了全局组件
```ts
import Vue from 'vue'
const SvgIcon = function() {
    return import(
        /* webpackChunkName: "low-priority" */ '@/components/SvgIcon/index.vue'
    )
}
/* 全局组件 Vue.component */
Vue.component('svg-icon', SvgIcon)

```

```html
<template>
    <div>
        <svg-icon icon="xxx" style="font-size:100px;"></svg-icon>
        <svg-icon icon="mt-xxx" style="font-size:100px;"></svg-icon>
    </div>
</template>  
```

# Mock
## javascript模式
在 **@/mock/modules** 下新建一个`名字随意.js`匹配`/admin/list`
```javascript
import { mock } from 'mockjs'
export default [
    {
        name: '/admin/list',
        method: 'get',
        description: '选填',
        onMock(opt, query, body) {
            const { pageNum, pageSize } = query
            return mock({
                code: 0,
                data: {
                    pageNum: Number(pageNum) || 1,
                    pageSize: Number(pageSize) || 10,
                    total: 66,
                    'result|10': [
                        {
                            createDate: '@date("yyyy-MM-dd")',
                            title: '@csentence(3, 5)',
                        },
                    ],
                },
                message: '请求提示',
            })
        },
    },
]

```

## json模式
在**@/mock/data**下新建`login/logout.json`，匹配`/login/logout`
```json
{
  "code": 200,
  "message": "message",
  "data": "data",
  "errors": [
    {
      "field": "errors_0_field",
      "info": "errors_0_info"
    },
    {
      "field": "errors_1_field",
      "info": "errors_1_info"
    },
    {
      "field": "errors_2_field",
      "info": "errors_2_info"
    }
  ]
}
```

## 引用
**main.ts**中引入
```ts
/* 条件编译 (必须是运行时可用的环境变量，并且变量值不能为 undefined，否则模块必定会打包) */
if (process.env.VUE_APP_MOCK === 'true') {
    require('@/mock') // 系统全局使用
    // require('./mock') 项目内部使用
}
```




# 模板

## 配置说明

### 项目基础信息
**settings.js**
```javascript
module.exports = {
    mode: 'history', // 路由模式  hash or history
    key: 'vue-template-admin', // 项目唯一性  英文
    title: '网站标题', // 浏览器标题
    keywords: 'SEO 关键词',
    description: 'PC-带权限管理的后台',
    filename: 'index.html',
}

```
### html模板
**index.html** 配合 **vue.config.js** 加载静态资源

### 路由



**meta**
|   名称   | 备注 |
| --- |--- |
| bodyClass | 挂载在body上的class，方便设置不同页面body的样式 |
| parent | 父级路由name，无则空，后台模板需设置'Index' |
| title | 路由标题，一般用于浏览器标题 |
| requireAuth | 是否需要登录访问|
| noCache | 后台模板开启tagsView后，不需要缓存页面则设为true |

```javascript
const AdminDashboard = () =>
    import(/* webpackChunkName: "AdminDashboard" */ './index')
export default {
    path: '/dashboard',
    name: 'AdminDashboard',
    component: AdminDashboard,
    meta: {
        bodyClass: 'Index',
        parent: 'Index',
        title: 'dashboard',
        requireAuth: true,
    },
}

```

### 打包 
每个项目下有自己的**vue.config.js**




## vue-template-homesite 通用的企业官网模板
TODO
## vue-template-mobile 通用的移动端模板
TODO

# 目录结构

## 工程目录结构

```
|-- .env.development ------------ dev 环境变量
|-- .env.development.local ------ dev 本地环境变量 (被 git 忽略，需手动新建，用来重写部分环境变量)
|-- .env.production ------------- prod 环境变量
|-- .vscode --------------------- 统一 VSCode 配置
|-- static-server.js ------------ 静态资源服务 (node 运行)，通常用于预览/检查打包结果，或者临时给其他人员启用前端服务
|-- docs ------------------------ 开发文档
|   |-- README.html ------------- 由 ../README.md 手动生成 (使用 VSCode 插件 Markdown Preview Enhanced)
|   |-- xxx.md
|   |-- xxx.html
|-- public
|   |-- favicon.ico
|   |-- index.html
|   |-- libs -------------------- 不支持模块化加载的第三方 ES5 类库/模块 (只能通过全局变量引用)
|-- src
    |-- libs -------------------- 支持模块化加载但是无法通过 npm 安装的第三方 ES5 类库/模块
    |-- assets
    |-- styles
    |   |-- global.less
    |   |-- reset.less
    |   |-- vars.less ----------- less 全局变量/函数 (webpack 自动注入)
    |   |-- xxx.less
    |-- entry -------------------- 多项目入口
    |   |-- x-admin ----- x后台
    |   |-- x-homesite ----- x官网
    |-- injects ----------------- vue 全局注册 (慎用)
    |   |-- index.js
    |   |-- $xxx.js
    |   |-- v-xxx.js
    |   |-- mixin-xxx.js
    |   |-- xxx.js
    |-- element-ui
    |   |-- index.js
    |   |-- rewrite ------------- 主题样式复写
    |       |-- index.less
    |       |-- xxx.less
    |-- vant
    |   |-- index.js
    |   |-- vars.less ----------- 内置变量复写
    |   |-- rewrite ------------- 主题样式复写
    |       |-- index.less
    |       |-- xxx.less
    |-- components
    |   |-- TheXxx.vue ---------- 单例组件
    |   |-- ExXxx.vue ----------- 扩展/包装第三方开源组件或内部公共库组件
    |   |-- XxxXxx.vue
    |   |-- ComponentExamples --- 非单例公共组件需要在这里写示例
    |   |   |-- index.vue
    |   |   |-- XxxXxx.vue
    |   |-- SvgIcon ------------- svg-sprite 图标组件
    |   |   |-- index.vue
    |   |   |-- icons
    |   |-- directives ---------- 可复用的自定义指令（局部注册）
    |   |   |-- xxx.js
    |   |-- mixins -------------- 可复用的混入（局部注册）
    |       |-- xxx.js
```

## 子应用目录结构

```
|-- api-hooks ---------- 接口局部拦截器
|   |-- xxx.js
|-- assets ------- 项目图片等资源
|-- components
|   |-- global
|   |   |-- my-dialog
|   |   |   |-- index.vue ------- 项目公共组件，页面可直接使用
|   |-- ExXxx.vue ----------- 扩展/包装第三方开源组件或内部公共库组件
|-- config ------- 项目环境参数配置
|-- mock
|   |-- data ------- 自动生成mock数据
|   |-- modules  ------- 自定义mock数据
|-- router
|   |   |-- index.js
|   |   |-- routes.js
|   |   |-- registerInterceptor.js
|-- scripts
|   |   |-- utils --------------- 通用方法
|   |   |-- constants ----------- 常量 (多使用 Object.freeze)
|   |   |-- eventBus ------------ 事件总线
|   |   |-- http ------------ axios实例
|-- services ------ API函数
|-- store ------ 数据存储
|-- styles
|   |   |-- vars.less ----------- less 全局变量/函数 (webpack 自动注入)
|-- views
|   |-- xxx ----------------- 除了 api 和 vuex，其它的专属模块要内聚在同一目录下
|       |-- index.vue  --------- 页面
|       |-- router.js --------- 路由
|       |-- components ------ 存放私有组件
|       |-- assets ------ 图片等资源
|-- api-generator.js --------- 自动生成API的命令
|-- App.vue
|-- index.html --------- 项目入口模板
|-- main.ts --------- 项目入口
|-- style.less --------- 项目css
|-- vue.config.js --------- 项目打包配置
 
```

# 前端部署

> nginx alias模式需要重定向 

## 后端支持跨域

### 无虚拟前缀
**.env.production**
```bash
NODE_ENV = production
VUE_APP_ENV = prod
# 是否使用gzip
VUE_APP_GZIP = false
# 后端服务地址
VUE_APP_BASEURL_API = http://x.x.x.x:19999
VUE_APP_MOCK = false
# 虚拟路径
BASE_URL = '/'
# 资源地址
outputDir = 'fed-data-quality-dist'
```

**nginx**

```
server {
    # 运维配置
    listen       4800;

    location / {
        root  /opt/fed-data-quality-dist;
        index  index.html;
        try_files $uri $uri/ /index.html;
    }
}
```

访问：http://59.202.42.163:480


### 开启虚拟前缀

**.env.production**
```bash
NODE_ENV = production
VUE_APP_ENV = prod
# 是否使用gzip
VUE_APP_GZIP = false
# 后端服务地址
VUE_APP_BASEURL_API = http://x.x.x.x:19999
VUE_APP_MOCK = false
# 虚拟路径
BASE_URL = '/fed-data-quality/'
# 资源地址
outputDir = 'fed-data-quality-dist'
```

**nginx**

```
server {
    # 运维配置
    listen       4800;
    location = /fed-data-quality {
        rewrite ^ http://59.202.42.163:480/fed-data-quality/;
    }

    location /fed-data-quality {
        alias  /opt/fed-data-quality-dist;
        index  index.html;
        try_files $uri $uri/ /opt/data-quality_html/index.html;
        
        # 首页禁止缓存
        if ($request_filename ~ .*\.(htm|html)$) {
            add_header Cache-Control "no-cache,no-store";
        } 
        # 静态资源默认缓存14天
        if ($request_filename ~ .*\.(js|css|png|jpg)$) {
            expires 336h;
        } 
    }
}
```

访问：http://59.202.42.163:480/fed-data-quality









